// armor-pubsub v0.2.0 Mon Aug 13 2018  
!function(n,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.ArmorPubSub=t():n.ArmorPubSub=t()}("undefined"!=typeof self?self:this,function(){return function(n){var t={};function r(e){if(t[e])return t[e].exports;var i=t[e]={i:e,l:!1,exports:{}};return n[e].call(i.exports,i,i.exports,r),i.l=!0,i.exports}return r.m=n,r.c=t,r.d=function(n,t,e){r.o(n,t)||Object.defineProperty(n,t,{enumerable:!0,get:e})},r.r=function(n){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(n,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(n,"__esModule",{value:!0})},r.t=function(n,t){if(1&t&&(n=r(n)),8&t)return n;if(4&t&&"object"==typeof n&&n&&n.__esModule)return n;var e=Object.create(null);if(r.r(e),Object.defineProperty(e,"default",{enumerable:!0,value:n}),2&t&&"string"!=typeof n)for(var i in n)r.d(e,i,function(t){return n[t]}.bind(null,i));return e},r.n=function(n){var t=n&&n.__esModule?function(){return n.default}:function(){return n};return r.d(t,"a",t),t},r.o=function(n,t){return Object.prototype.hasOwnProperty.call(n,t)},r.p="",r(r.s=0)}([function(n,t,r){"use strict";var e=c(r(1)),i=r(6),u=c(i),o=c(r(7)),s=r(2);function c(n){return n&&n.__esModule?n:{default:n}}var f={hasSub:function(n,t,r){var e=this._armorPubSub;if((0,s.isEmptyArray)(e))return!1;var i=r||{},u=i.ns,o=i.ctx,c=void 0;for(c=0;c<e.length;c++){var f=e[c],a=f.topic,l=f.callback,d=f.ns,v=f.ctx;if(!(void 0!=n&&n!==a||void 0!=t&&t!==l||void 0!=u&&u!==d||o&&o!==v))return!0}return!1},sub:function(n,t,r){if((0,s.isFunction)(t)){var u=r||{},o=u.ns,c=u.ctx,f=(0,e.default)(this,n,t,{ns:o,ctx:c});return function(){return(0,i.unsubscribeByIdInQueue)(f)}}},subOnce:function(n,t,r){if((0,s.isFunction)(t)){var u=r||{},o=u.ns,c=u.ctx,f=(0,e.default)(this,n,t,{ns:o,ctx:c,once:!0});return function(){return(0,i.unsubscribeByIdInQueue)(f)}}},pub:function(n,t,r){return(0,o.default)(n,t,r)},unsub:function(n,t,r){return(0,u.default)(this,n,t,r)}};n.exports=f},function(n,t,r){"use strict";t.__esModule=!0,t.default=function(n,t,r,u){var o=u||{},s=o.once,c=o.ns,f=o.ctx;c=(0,e.safeNs)(c),t=(0,e.safeTopic)(t),f||(f=n);var a=(0,i.getRegistry)(c,!0),l=a[t]||(a[t]=[]),d=(0,e.subId)(),v={id:d,callback:r,ctx:f,ns:c,once:s,subscriber:n,topic:t};return i.book.register(v),l.push(v),(n._armorPubSub||(n._armorPubSub=[])).push(v),d};var e=r(2),i=r(5)},function(n,t,r){"use strict";t.__esModule=!0,t.subId=t.queue=void 0,t.safeNs=function(n){return void 0==n?"default":n},t.safeTopic=function(n){return void 0==n?"":n},t.isString=function(n){return"string"==typeof n},t.isEmptyArray=function(n){return!n||0===n.length},t.isFunction=function(n){return"function"==typeof n};r(3);t.queue=function(){var n=[],t=!1,r={ongoing:0,promise:null};function e(){t=!1,r.ongoing=0}return function(i){if(n.push(i),t)return r.promise;var u=void 0,o=void 0;r.promise=new Promise(function(n,t){u=n,o=t}),t=!0,i=n.shift();var s=function(){!function(t){r.ongoing--,0===n.length&&0===r.ongoing&&t()}(u)};try{for(;i;){var c;r.ongoing++,(c=i).fn.apply(c,i.args.concat([s])),i=n.shift()}e()}catch(n){e(),o(n)}return r.promise}}(),t.subId=function(){var n=0;return function(){return++n}}()},function(n,t,r){(function(n){function r(n,t){for(var r=0,e=n.length-1;e>=0;e--){var i=n[e];"."===i?n.splice(e,1):".."===i?(n.splice(e,1),r++):r&&(n.splice(e,1),r--)}if(t)for(;r--;r)n.unshift("..");return n}var e=/^(\/?|)([\s\S]*?)((?:\.{1,2}|[^\/]+?|)(\.[^.\/]*|))(?:[\/]*)$/,i=function(n){return e.exec(n).slice(1)};function u(n,t){if(n.filter)return n.filter(t);for(var r=[],e=0;e<n.length;e++)t(n[e],e,n)&&r.push(n[e]);return r}t.resolve=function(){for(var t="",e=!1,i=arguments.length-1;i>=-1&&!e;i--){var o=i>=0?arguments[i]:n.cwd();if("string"!=typeof o)throw new TypeError("Arguments to path.resolve must be strings");o&&(t=o+"/"+t,e="/"===o.charAt(0))}return t=r(u(t.split("/"),function(n){return!!n}),!e).join("/"),(e?"/":"")+t||"."},t.normalize=function(n){var e=t.isAbsolute(n),i="/"===o(n,-1);return(n=r(u(n.split("/"),function(n){return!!n}),!e).join("/"))||e||(n="."),n&&i&&(n+="/"),(e?"/":"")+n},t.isAbsolute=function(n){return"/"===n.charAt(0)},t.join=function(){var n=Array.prototype.slice.call(arguments,0);return t.normalize(u(n,function(n,t){if("string"!=typeof n)throw new TypeError("Arguments to path.join must be strings");return n}).join("/"))},t.relative=function(n,r){function e(n){for(var t=0;t<n.length&&""===n[t];t++);for(var r=n.length-1;r>=0&&""===n[r];r--);return t>r?[]:n.slice(t,r-t+1)}n=t.resolve(n).substr(1),r=t.resolve(r).substr(1);for(var i=e(n.split("/")),u=e(r.split("/")),o=Math.min(i.length,u.length),s=o,c=0;c<o;c++)if(i[c]!==u[c]){s=c;break}var f=[];for(c=s;c<i.length;c++)f.push("..");return(f=f.concat(u.slice(s))).join("/")},t.sep="/",t.delimiter=":",t.dirname=function(n){var t=i(n),r=t[0],e=t[1];return r||e?(e&&(e=e.substr(0,e.length-1)),r+e):"."},t.basename=function(n,t){var r=i(n)[2];return t&&r.substr(-1*t.length)===t&&(r=r.substr(0,r.length-t.length)),r},t.extname=function(n){return i(n)[3]};var o="b"==="ab".substr(-1)?function(n,t,r){return n.substr(t,r)}:function(n,t,r){return t<0&&(t=n.length+t),n.substr(t,r)}}).call(this,r(4))},function(n,t){var r,e,i=n.exports={};function u(){throw new Error("setTimeout has not been defined")}function o(){throw new Error("clearTimeout has not been defined")}function s(n){if(r===setTimeout)return setTimeout(n,0);if((r===u||!r)&&setTimeout)return r=setTimeout,setTimeout(n,0);try{return r(n,0)}catch(t){try{return r.call(null,n,0)}catch(t){return r.call(this,n,0)}}}!function(){try{r="function"==typeof setTimeout?setTimeout:u}catch(n){r=u}try{e="function"==typeof clearTimeout?clearTimeout:o}catch(n){e=o}}();var c,f=[],a=!1,l=-1;function d(){a&&c&&(a=!1,c.length?f=c.concat(f):l=-1,f.length&&v())}function v(){if(!a){var n=s(d);a=!0;for(var t=f.length;t;){for(c=f,f=[];++l<t;)c&&c[l].run();l=-1,t=f.length}c=null,a=!1,function(n){if(e===clearTimeout)return clearTimeout(n);if((e===o||!e)&&clearTimeout)return e=clearTimeout,clearTimeout(n);try{e(n)}catch(t){try{return e.call(null,n)}catch(t){return e.call(this,n)}}}(n)}}function b(n,t){this.fun=n,this.array=t}function p(){}i.nextTick=function(n){var t=new Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)t[r-1]=arguments[r];f.push(new b(n,t)),1!==f.length||a||s(v)},b.prototype.run=function(){this.fun.apply(null,this.array)},i.title="browser",i.browser=!0,i.env={},i.argv=[],i.version="",i.versions={},i.on=p,i.addListener=p,i.once=p,i.off=p,i.removeListener=p,i.removeAllListeners=p,i.emit=p,i.prependListener=p,i.prependOnceListener=p,i.listeners=function(n){return[]},i.binding=function(n){throw new Error("process.binding is not supported")},i.cwd=function(){return"/"},i.chdir=function(n){throw new Error("process.chdir is not supported")},i.umask=function(){return 0}},function(n,t,r){"use strict";t.__esModule=!0,t.namespaces=t.book=void 0,t.registerSubscribing=function(n){var t=n.id;SUBSCRIBINGS[t]=n},t.getRegistry=function(n,t){n=(0,e.safeNs)(n);var r=i[n];!r&&t&&(r=i[n]={});return r},t.removeRegistry=function(n){delete i[n]};var e=r(2);t.book={subscribings:{},register:function(n){var t=n.id;this.subscribings[t]=n},get:function(n){return this.subscribings[n]},remove:function(n){var t=this.subscribings[n];return t&&delete this.subscribings[n],t}};var i=t.namespaces={default:{}}},function(n,t,r){"use strict";t.__esModule=!0,t.unsubscribeById=o,t.unsubscribeByIdInQueue=function(n){return(0,e.queue)({fn:o,args:[n]})},t.default=function(n,t,r,i){return(0,e.queue)({fn:u,args:[n,t,r,i]})};var e=r(2),i=r(5);function u(n,t,r,i,u){var s=n._armorPubSub;if(!(0,e.isEmptyArray)(s)){var c=i||{},f=c.ns,a=c.ctx,l=[],d=void 0,v=void 0;for(v=0;v<s.length;v++){var b=d=s[v],p=b.topic,g=b.callback,h=b.ns,m=b.ctx;void 0!=t&&t!==p||void 0!=r&&r!==g||void 0!=f&&f!==h||a&&a!==m||l.push(d)}for(v=0;v<l.length;v++)o(l[v].id);u()}}function o(n,t){var r=i.book.get(n);r&&(i.book.remove(n),function(n){var t=n.ns,r=n.id,e=n.topic,u=(0,i.getRegistry)(t);if(u){var o=u[e];if(o){var s=o.findIndex(function(n){return n.id===r});o.splice(s,1),0===o.length&&(delete u[e],0===Object.keys(u).length&&(0,i.removeRegistry)(t))}}}(r),function(n){var t=n.id,r=n.subscriber._armorPubSub;if(r){var e=r.findIndex(function(n){return n.id===t});r.splice(e,1)}}(r)),t&&t()}},function(n,t,r){"use strict";t.__esModule=!0,t.default=function(n,t,r){return(0,e.queue)({fn:c,args:[n,t,r]})};var e=r(2),i=r(5),u=r(6);function o(n,t){var r=n.callback,e=n.ctx;r.call(e,t)}function s(n,t){setTimeout(function(){o(n,t)})}function c(n,t,r,c){var f=r||{},a=f.ns,l=f.sync;a=(0,e.safeNs)(a),n=(0,e.safeTopic)(n);var d=(0,i.getRegistry)(a);if(d){var v=d[n];if(!(0,e.isEmptyArray)(v)){for(var b=[],p=l?o:s,g=0,h=void 0;g<v.length;){p(h=v[g++],t),h.once&&b.push(h)}for(var m=0;m<b.length;m++)(0,u.unsubscribeById)(b[m].id);c()}}}}])});