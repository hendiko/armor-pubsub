// armor-pubsub v0.1.0 Fri Aug 10 2018  
!function(e,n){"object"==typeof exports&&"object"==typeof module?module.exports=n():"function"==typeof define&&define.amd?define([],n):"object"==typeof exports?exports.ArmorPubSub=n():e.ArmorPubSub=n()}("undefined"!=typeof self?self:this,function(){return function(e){var n={};function t(r){if(n[r])return n[r].exports;var u=n[r]={i:r,l:!1,exports:{}};return e[r].call(u.exports,u,u.exports,t),u.l=!0,u.exports}return t.m=e,t.c=n,t.d=function(e,n,r){t.o(e,n)||Object.defineProperty(e,n,{enumerable:!0,get:r})},t.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},t.t=function(e,n){if(1&n&&(e=t(e)),8&n)return e;if(4&n&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(t.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&n&&"string"!=typeof e)for(var u in e)t.d(r,u,function(n){return e[n]}.bind(null,u));return r},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,n){return Object.prototype.hasOwnProperty.call(e,n)},t.p="",t(t.s=0)}([function(e,n,t){"use strict";var r=c(t(1)),u=t(4),i=c(u),o=c(t(5)),s=t(2);function c(e){return e&&e.__esModule?e:{default:e}}var f={hasSub:function(e,n,t){var r=this._armorPubSub;if((0,s.isEmptyArray)(r))return!1;var u=t||{},i=u.ns,o=u.ctx,c=void 0;for(c=0;c<r.length;c++){var f=r[c],a=f.topic,d=(f.callback,f.ns),b=f.ctx;if(!(void 0!=e&&e!==a||void 0!=n&&n!==a||void 0!=i&&i!==d||o&&o!==b))return!0}return!1},sub:function(e,n,t){if((0,s.isFunction)(n)){var i=t||{},o=i.ns,c=i.ctx,f=(0,r.default)(this,e,n,{ns:o,ctx:c});return function(){(0,u.unsubscribeByIdInQueue)(f)}}},subOnce:function(e,n,t){if((0,s.isFunction)(n)){var i=t||{},o=i.ns,c=i.ctx,f=(0,r.default)(this,e,n,{ns:o,ctx:c,once:!0});return function(){(0,u.unsubscribeByIdInQueue)(f)}}},pub:function(e,n,t){return(0,o.default)(e,n,t),this},unsub:function(e,n,t){return(0,i.default)(this,e,n,t),this}};e.exports=f},function(e,n,t){"use strict";n.__esModule=!0,n.default=function(e,n,t,i){var o=i||{},s=o.once,c=o.ns,f=o.ctx;c=(0,r.safeNs)(c),n=(0,r.safeTopic)(n),f||(f=e);var a=(0,u.getRegistry)(c,!0),d=a[n]||(a[n]=[]),b=(0,r.subId)(),l={id:b,callback:t,ctx:f,ns:c,once:s,subscriber:e,topic:n};return u.book.register(l),d.push(l),(e._armorPubSub||(e._armorPubSub=[])).push(l),b};var r=t(2),u=t(3)},function(e,n,t){"use strict";n.__esModule=!0,n.safeNs=function(e){return void 0==e?"default":e},n.safeTopic=function(e){return void 0==e?"":e},n.isEmptyArray=function(e){return!e||0===e.length},n.isFunction=function(e){return"function"==typeof e};n.queue=function(){var e=[],n=!1;return function(t){if(e.push(t),!n){for(n=!0,t=e.shift();t;){var r;(r=t).fn.apply(r,t.args),t=e.shift()}n=!1}}}(),n.subId=function(){var e=0;return function(){return++e}}()},function(e,n,t){"use strict";n.__esModule=!0,n.namespaces=n.book=void 0,n.registerSubscribing=function(e){var n=e.id;SUBSCRIBINGS[n]=e},n.getRegistry=function(e,n){e=(0,r.safeNs)(e);var t=u[e];!t&&n&&(t=u[e]={});return t},n.removeRegistry=function(e){delete u[e]};var r=t(2);n.book={subscribings:{},register:function(e){var n=e.id;this.subscribings[n]=e},get:function(e){return this.subscribings[e]},remove:function(e){var n=this.subscribings[e];return n&&delete this.subscribings[e],n}};var u=n.namespaces={default:{}}},function(e,n,t){"use strict";n.__esModule=!0,n.unsubscribeById=o,n.unsubscribeByIdInQueue=function(e){(0,r.queue)({fn:o,args:[e]})},n.default=function(e,n,t,u){(0,r.queue)({fn:i,args:[e,n,t,u]})};var r=t(2),u=t(3);function i(e,n,t,u){var i=e._armorPubSub;if(!(0,r.isEmptyArray)(i)){var s=u||{},c=s.ns,f=s.ctx,a=[],d=void 0,b=void 0;for(b=0;b<i.length;b++){var l=d=i[b],v=l.topic,p=(l.callback,l.ns),y=l.ctx;void 0!=n&&n!==v||void 0!=t&&t!==v||void 0!=c&&c!==p||f&&f!==y||a.push(d)}for(b=0;b<a.length;b++)o(a[b].id)}}function o(e){var n=u.book.get(e);n&&(u.book.remove(e),function(e){var n=e.ns,t=e.id,r=e.topic,i=(0,u.getRegistry)(n);if(i){var o=i[r];if(o){var s=o.findIndex(function(e){return e.id===t});o.splice(s,1),0===o.length&&(delete i[r],0===Object.keys(i).length&&(0,u.removeRegistry)(n))}}}(n),function(e){var n=e.id,t=e.subscriber._armorPubSub;if(t){var r=t.findIndex(function(e){return e.id===n});t.splice(r,1)}}(n))}},function(e,n,t){"use strict";n.__esModule=!0,n.default=function(e,n,t){(0,r.queue)({fn:c,args:[e,n,t]})};var r=t(2),u=t(3),i=t(4);function o(e,n){var t=e.callback,r=e.ctx;t.call(r,n)}function s(e,n){setTimeout(function(){o(e,n)})}function c(e,n,t){var c=t||{},f=c.ns,a=c.sync;f=(0,r.safeNs)(f),e=(0,r.safeTopic)(e);var d=(0,u.getRegistry)(f);if(d){var b=d[e];if(!(0,r.isEmptyArray)(b)){for(var l=[],v=a?o:s,p=0,y=void 0;p<b.length;){v(y=b[p++],n),y.once&&l.push(y)}for(var g=0;g<l.length;g++)(0,i.unsubscribeById)(l[g].id)}}}}])});