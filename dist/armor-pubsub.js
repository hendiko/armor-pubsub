// armor-pubsub v0.2.0 Tue Aug 14 2018  
!function(n,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.ArmorPubSub=e():n.ArmorPubSub=e()}("undefined"!=typeof self?self:this,function(){return function(n){var e={};function t(r){if(e[r])return e[r].exports;var u=e[r]={i:r,l:!1,exports:{}};return n[r].call(u.exports,u,u.exports,t),u.l=!0,u.exports}return t.m=n,t.c=e,t.d=function(n,e,r){t.o(n,e)||Object.defineProperty(n,e,{enumerable:!0,get:r})},t.r=function(n){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(n,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(n,"__esModule",{value:!0})},t.t=function(n,e){if(1&e&&(n=t(n)),8&e)return n;if(4&e&&"object"==typeof n&&n&&n.__esModule)return n;var r=Object.create(null);if(t.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:n}),2&e&&"string"!=typeof n)for(var u in n)t.d(r,u,function(e){return n[e]}.bind(null,u));return r},t.n=function(n){var e=n&&n.__esModule?function(){return n.default}:function(){return n};return t.d(e,"a",e),e},t.o=function(n,e){return Object.prototype.hasOwnProperty.call(n,e)},t.p="",t(t.s=0)}([function(n,e,t){"use strict";var r=c(t(1)),u=t(4),i=c(u),o=c(t(5)),s=t(2);function c(n){return n&&n.__esModule?n:{default:n}}var f={hasSub:function(n,e,t){var r=this._armorPubSub;if((0,s.isEmptyArray)(r))return!1;var u=t||{},i=u.ns,o=u.ctx,c=void 0;for(c=0;c<r.length;c++){var f=r[c],a=f.topic,d=f.callback,b=f.ns,l=f.ctx;if(!(void 0!=n&&n!==a||void 0!=e&&e!==d||void 0!=i&&i!==b||o&&o!==l))return!0}return!1},sub:function(n,e,t){if((0,s.isFunction)(e)){var i=t||{},o=i.ns,c=i.ctx,f=(0,r.default)(this,n,e,{ns:o,ctx:c});return function(){return(0,u.unsubscribeByIdInQueue)(f)}}},subOnce:function(n,e,t){if((0,s.isFunction)(e)){var i=t||{},o=i.ns,c=i.ctx,f=(0,r.default)(this,n,e,{ns:o,ctx:c,once:!0});return function(){return(0,u.unsubscribeByIdInQueue)(f)}}},pub:function(n,e,t){return(0,o.default)(n,e,t)},unsub:function(n,e,t){return(0,i.default)(this,n,e,t)}};n.exports=f},function(n,e,t){"use strict";e.__esModule=!0,e.default=function(n,e,t,i){var o=i||{},s=o.once,c=o.ns,f=o.ctx;c=(0,r.safeNs)(c),e=(0,r.safeTopic)(e),f||(f=n);var a=(0,u.getRegistry)(c,!0),d=a[e]||(a[e]=[]),b=(0,r.subId)(),l={id:b,callback:t,ctx:f,ns:c,once:s,subscriber:n,topic:e};return u.book.register(l),d.push(l),(n._armorPubSub||(n._armorPubSub=[])).push(l),b};var r=t(2),u=t(3)},function(n,e,t){"use strict";e.__esModule=!0,e.safeNs=function(n){return void 0==n?"default":n},e.safeTopic=function(n){return void 0==n?"":n},e.isString=function(n){return"string"==typeof n},e.isEmptyArray=function(n){return!n||0===n.length},e.isFunction=function(n){return"function"==typeof n};e.queue=function(){var n=[],e=!1,t=void 0;return function(r){if(n.push(r),e)return t;var u=void 0,i=void 0;t=new Promise(function(n,e){u=n,i=e}),e=!0,r=n.shift();try{for(;r;){var o;(o=r).fn.apply(o,r.args),r=n.shift()}e=!1,u()}catch(n){e=!1,i(n)}return t}}(),e.subId=function(){var n=0;return function(){return++n}}()},function(n,e,t){"use strict";e.__esModule=!0,e.namespaces=e.book=void 0,e.registerSubscribing=function(n){var e=n.id;SUBSCRIBINGS[e]=n},e.getRegistry=function(n,e){n=(0,r.safeNs)(n);var t=u[n];!t&&e&&(t=u[n]={});return t},e.removeRegistry=function(n){delete u[n]};var r=t(2);e.book={subscribings:{},register:function(n){var e=n.id;this.subscribings[e]=n},get:function(n){return this.subscribings[n]},remove:function(n){var e=this.subscribings[n];return e&&delete this.subscribings[n],e}};var u=e.namespaces={default:{}}},function(n,e,t){"use strict";e.__esModule=!0,e.unsubscribeById=o,e.unsubscribeByIdInQueue=function(n){return(0,r.queue)({fn:o,args:[n]})},e.default=function(n,e,t,u){return(0,r.queue)({fn:i,args:[n,e,t,u]})};var r=t(2),u=t(3);function i(n,e,t,u){var i=n._armorPubSub;if(!(0,r.isEmptyArray)(i)){var s=u||{},c=s.ns,f=s.ctx,a=[],d=void 0,b=void 0;for(b=0;b<i.length;b++){var l=d=i[b],v=l.topic,p=l.callback,y=l.ns,g=l.ctx;void 0!=e&&e!==v||void 0!=t&&t!==p||void 0!=c&&c!==y||f&&f!==g||a.push(d)}for(b=0;b<a.length;b++)o(a[b].id)}}function o(n){var e=u.book.get(n);e&&(u.book.remove(n),function(n){var e=n.ns,t=n.id,r=n.topic,i=(0,u.getRegistry)(e);if(i){var o=i[r];if(o){var s=o.findIndex(function(n){return n.id===t});o.splice(s,1),0===o.length&&(delete i[r],0===Object.keys(i).length&&(0,u.removeRegistry)(e))}}}(e),function(n){var e=n.id,t=n.subscriber._armorPubSub;if(t){var r=t.findIndex(function(n){return n.id===e});t.splice(r,1)}}(e))}},function(n,e,t){"use strict";e.__esModule=!0,e.default=function(n,e,t){return(0,r.queue)({fn:c,args:[n,e,t]})};var r=t(2),u=t(3),i=t(4);function o(n,e){var t=n.callback,r=n.ctx;t.call(r,e)}function s(n,e){setTimeout(function(){o(n,e)})}function c(n,e,t){var c=t||{},f=c.ns,a=c.sync;f=(0,r.safeNs)(f),n=(0,r.safeTopic)(n);var d=(0,u.getRegistry)(f);if(d){var b=d[n];if(!(0,r.isEmptyArray)(b)){for(var l=[],v=a?o:s,p=0,y=void 0;p<b.length;){v(y=b[p++],e),y.once&&l.push(y)}for(var g=0;g<l.length;g++)(0,i.unsubscribeById)(l[g].id)}}}}])});